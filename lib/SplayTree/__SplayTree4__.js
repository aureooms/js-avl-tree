"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.default = __SplayTree4__;
function __SplayTree4__(diff) {

	var node = function node(v) {
		this.l = this.r = null;
		this.v = v;
	};

	var item = function item(d, pt) {
		this.d = d;
		this.pt = pt;
	};

	var splay = function splay(el, v) {

		var l, r, t, y, x, d;
		l = r = x = new node();
		t = el;
		while (true) {
			d = diff(v, t.v);
			if (d < 0) {
				if (!t.l) break;
				if (diff(v, t.l.v) < 0) {
					y = t.l;
					t.l = y.r;
					y.r = t;
					t = y;
					if (!t.l) break;
				}
				r.l = t;
				r = t;
				t = t.l;
			} else if (d > 0) {
				if (!t.r) break;
				if (diff(v, t.r.v) > 0) {
					y = t.r;
					t.r = y.l;
					y.l = t;
					t = y;
					if (!t.r) break;
				}
				l.r = t;
				l = t;
				t = t.r;
			} else break;
		}
		l.r = t.l;
		r.l = t.r;
		t.l = x.r;
		t.r = x.l;

		return new item(d, t);
	};

	var remove = function remove(el, v) {
		var i = splay(el, v);
		var pt = i.pt;
		if (i.d !== 0) return pt;

		if (pt.l === null) return pt.r;else if (pt.r === null) return pt.l;else {
			pt.l = splay(pt.l, v).pt;
			pt.l.r = pt.r;
			return pt.l;
		}
	};

	var in_order_traversal = function in_order_traversal(pt, fn) {
		if (pt.l !== null) in_order_traversal(pt.l, fn);
		fn(pt.v);
		if (pt.r !== null) in_order_traversal(pt.r, fn);
	};

	var splay_tree = function splay_tree() {
		this.pt = null;
	};

	splay_tree.prototype.insert = function (v) {
		var n = new node(v);
		if (this.pt !== null) {
			var i = splay(this.pt, v);
			this.pt = i.pt;

			if (i.d <= 0) {
				n.l = this.pt.l;
				n.r = this.pt;
				this.pt.l = null;
			} else {
				n.r = this.pt.r;
				n.l = this.pt;
				this.pt.r = null;
			}
		}
		this.pt = n;
	};

	splay_tree.prototype.find = function (v) {
		if (this.pt === null) return [false, null];
		var i = splay(this.pt, v);
		this.pt = i.pt;
		return [i.d === 0, this.pt.v];
	};

	splay_tree.prototype.remove = function (v) {
		if (this.pt !== null) this.pt = remove(this.pt, v);
	};

	splay_tree.prototype.in_order_traversal = function (fn) {
		if (this.pt !== null) in_order_traversal(this.pt, fn);
	};

	return splay_tree;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9TcGxheVRyZWUvX19TcGxheVRyZWU0X18uanMiXSwibmFtZXMiOlsiX19TcGxheVRyZWU0X18iLCJkaWZmIiwibm9kZSIsInYiLCJsIiwiciIsIml0ZW0iLCJkIiwicHQiLCJzcGxheSIsImVsIiwidCIsInkiLCJ4IiwicmVtb3ZlIiwiaSIsImluX29yZGVyX3RyYXZlcnNhbCIsImZuIiwic3BsYXlfdHJlZSIsInByb3RvdHlwZSIsImluc2VydCIsIm4iLCJmaW5kIl0sIm1hcHBpbmdzIjoiOzs7OztrQkFDd0JBLGM7QUFBVCxTQUFTQSxjQUFULENBQXdCQyxJQUF4QixFQUE2Qjs7QUFFM0MsS0FBSUMsT0FBTyxTQUFQQSxJQUFPLENBQVNDLENBQVQsRUFBVztBQUNyQixPQUFLQyxDQUFMLEdBQVMsS0FBS0MsQ0FBTCxHQUFTLElBQWxCO0FBQ0EsT0FBS0YsQ0FBTCxHQUFTQSxDQUFUO0FBQ0EsRUFIRDs7QUFLQSxLQUFJRyxPQUFPLFNBQVBBLElBQU8sQ0FBU0MsQ0FBVCxFQUFZQyxFQUFaLEVBQWU7QUFDekIsT0FBS0QsQ0FBTCxHQUFTQSxDQUFUO0FBQ0EsT0FBS0MsRUFBTCxHQUFVQSxFQUFWO0FBQ0EsRUFIRDs7QUFLQSxLQUFJQyxRQUFRLFNBQVJBLEtBQVEsQ0FBU0MsRUFBVCxFQUFhUCxDQUFiLEVBQWU7O0FBRTFCLE1BQUlDLENBQUosRUFBT0MsQ0FBUCxFQUFVTSxDQUFWLEVBQWFDLENBQWIsRUFBZ0JDLENBQWhCLEVBQW1CTixDQUFuQjtBQUNBSCxNQUFJQyxJQUFJUSxJQUFJLElBQUlYLElBQUosRUFBWjtBQUNBUyxNQUFJRCxFQUFKO0FBQ0EsU0FBTyxJQUFQLEVBQWE7QUFDWkgsT0FBSU4sS0FBS0UsQ0FBTCxFQUFRUSxFQUFFUixDQUFWLENBQUo7QUFDQSxPQUFJSSxJQUFJLENBQVIsRUFBVztBQUNWLFFBQUksQ0FBQ0ksRUFBRVAsQ0FBUCxFQUFVO0FBQ1YsUUFBSUgsS0FBS0UsQ0FBTCxFQUFRUSxFQUFFUCxDQUFG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QUFPQyxVQUFQO0FBRUEiLCJmaWxlIjoiX19TcGxheVRyZWU0X18uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIF9fU3BsYXlUcmVlNF9fKGRpZmYpe1xuXG5cdHZhciBub2RlID0gZnVuY3Rpb24odil7XG5cdFx0dGhpcy5sID0gdGhpcy5yID0gbnVsbDtcblx0XHR0aGlzLnYgPSB2O1xuXHR9O1xuXG5cdHZhciBpdGVtID0gZnVuY3Rpb24oZCwgcHQpe1xuXHRcdHRoaXMuZCA9IGQ7XG5cdFx0dGhpcy5wdCA9IHB0O1xuXHR9O1xuXG5cdHZhciBzcGxheSA9IGZ1bmN0aW9uKGVsLCB2KXtcblxuXHRcdHZhciBsLCByLCB0LCB5LCB4LCBkO1xuXHRcdGwgPSByID0geCA9IG5ldyBub2RlKCk7XG5cdFx0dCA9IGVsO1xuXHRcdHdoaWxlICh0cnVlKSB7XG5cdFx0XHRkID0gZGlmZih2LCB0LnYpO1xuXHRcdFx0aWYgKGQgPCAwKSB7XG5cdFx0XHRcdGlmICghdC5sKSBicmVhaztcblx0XHRcdFx0aWYgKGRpZmYodiwgdC5sLnYpIDwgMCkge1xuXHRcdFx0XHRcdHkgPSB0Lmw7XG5cdFx0XHRcdFx0dC5sID0geS5yO1xuXHRcdFx0XHRcdHkuciA9IHQ7XG5cdFx0XHRcdFx0dCA9IHk7XG5cdFx0XHRcdFx0aWYgKCF0LmwpIGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHIubCA9IHQ7XG5cdFx0XHRcdHIgPSB0O1xuXHRcdFx0XHR0ID0gdC5sO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSBpZiAoZCA+IDApIHtcblx0XHRcdFx0aWYgKCF0LnIpIGJyZWFrO1xuXHRcdFx0XHRpZiAoZGlmZih2LCB0LnIudikgPiAwKSB7XG5cdFx0XHRcdFx0eSA9IHQucjtcblx0XHRcdFx0XHR0LnIgPSB5Lmw7XG5cdFx0XHRcdFx0eS5sID0gdDtcblx0XHRcdFx0XHR0ID0geTtcblx0XHRcdFx0XHRpZiAoIXQucikgYnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdFx0bC5yID0gdDtcblx0XHRcdFx0bCA9IHQ7XG5cdFx0XHRcdHQgPSB0LnI7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIGJyZWFrO1xuXHRcdH1cblx0XHRsLnIgPSB0Lmw7XG5cdFx0ci5sID0gdC5yO1xuXHRcdHQubCA9IHgucjtcblx0XHR0LnIgPSB4Lmw7XG5cblx0XHRyZXR1cm4gbmV3IGl0ZW0oZCwgdCk7XG5cdH07XG5cblx0dmFyIHJlbW92ZSA9IGZ1bmN0aW9uKGVsLCB2KXtcblx0XHR2YXIgaSA9IHNwbGF5KGVsLCB2KTtcblx0XHR2YXIgcHQgPSBpLnB0O1xuXHRcdGlmIChpLmQgIT09IDApIHJldHVybiBwdDtcblxuXHRcdGlmICAgICAgKHB0LmwgPT09IG51bGwpIHJldHVybiBwdC5yO1xuXHRcdGVsc2UgaWYgKHB0LnIgPT09IG51bGwpIHJldHVybiBwdC5sO1xuXHRcdGVsc2Uge1xuXHRcdFx0cHQubCA9IHNwbGF5KHB0LmwsIHYpLnB0O1xuXHRcdFx0cHQubC5yID0gcHQucjtcblx0XHRcdHJldHVybiBwdC5sO1xuXHRcdH1cblx0fTtcblxuXHR2YXIgaW5fb3JkZXJfdHJhdmVyc2FsID0gZnVuY3Rpb24ocHQsIGZuKXtcblx0XHRpZihwdC5sICE9PSBudWxsKSBpbl9vcmRlcl90cmF2ZXJzYWwocHQubCwgZm4pO1xuXHRcdGZuKHB0LnYpO1xuXHRcdGlmKHB0LnIgIT09IG51bGwpIGluX29yZGVyX3RyYXZlcnNhbChwdC5yLCBmbik7XG5cdH07XG5cblxuXHR2YXIgc3BsYXlfdHJlZSA9IGZ1bmN0aW9uKCl7IHRoaXMucHQgPSBudWxsOyB9O1xuXG5cdHNwbGF5X3RyZWUucHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uKHYpe1xuXHRcdHZhciBuID0gbmV3IG5vZGUodik7XG5cdFx0aWYgKHRoaXMucHQgIT09IG51bGwpIHtcblx0XHRcdHZhciBpID0gc3BsYXkodGhpcy5wdCwgdik7XG5cdFx0XHR0aGlzLnB0ID0gaS5wdDtcblxuXHRcdFx0aWYgKGkuZCA8PSAwKSB7XG5cdFx0XHRcdG4ubCA9IHRoaXMucHQubDtcblx0XHRcdFx0bi5yID0gdGhpcy5wdDtcblx0XHRcdFx0dGhpcy5wdC5sID0gbnVsbDtcblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRuLnIgPSB0aGlzLnB0LnI7XG5cdFx0XHRcdG4ubCA9IHRoaXMucHQ7XG5cdFx0XHRcdHRoaXMucHQuciA9IG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHRoaXMucHQgPSBuO1xuXHR9O1xuXG5cdHNwbGF5X3RyZWUucHJvdG90eXBlLmZpbmQgPSBmdW5jdGlvbih2KXtcblx0XHRpZih0aGlzLnB0ID09PSBudWxsKSByZXR1cm4gW2ZhbHNlLCBudWxsXTtcblx0XHR2YXIgaSA9IHNwbGF5KHRoaXMucHQsIHYpO1xuXHRcdHRoaXMucHQgPSBpLnB0O1xuXHRcdHJldHVybiBbaS5kID09PSAwLCB0aGlzLnB0LnZdO1xuXHR9O1xuXG5cdHNwbGF5X3RyZWUucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKHYpe1xuXHRcdGlmKHRoaXMucHQgIT09IG51bGwpIHRoaXMucHQgPSByZW1vdmUodGhpcy5wdCwgdik7XG5cdH07XG5cblx0c3BsYXlfdHJlZS5wcm90b3R5cGUuaW5fb3JkZXJfdHJhdmVyc2FsID0gZnVuY3Rpb24oZm4pe1xuXHRcdGlmKHRoaXMucHQgIT09IG51bGwpIGluX29yZGVyX3RyYXZlcnNhbCh0aGlzLnB0LCBmbik7XG5cdH07XG5cblx0cmV0dXJuIHNwbGF5X3RyZWU7XG5cbn1cblxuIl19